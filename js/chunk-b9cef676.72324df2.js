(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b9cef676"],{"08d2":function(t,e,a){"use strict";a("c9f6")},"09e4":function(t,e,a){"use strict";a("99af"),a("b0c0");e["a"]={generalErrorHandler:function(t){return function(e){t instanceof Error?e.$store.dispatch("ADD_NOTIFICATION",{type:"error",message:"".concat(t.name,": ").concat(t.message)}):e.$store.dispatch("ADD_NOTIFICATION",{type:"error",message:"".concat(t)})}}}},"133c":function(t,e,a){},"4ad7":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACTSURBVHgB7dZBCsJAEETRwhN4w9TN5wjxBppBF6IGlQnp7vAfFGQVqmdVEgAAOJZpybykPb5L6YWvT5lVyGv5nqYiPpXvsQqgfBTKR6F8FMpHWSu/V5oGN1WTQor/tKlO+u6seBcNsOJf3xrklZ9PKsTiiBwsjsjB4ogcLI7Iwfpjw2RlvS/Jcqx78U02DAAAyOwG2DPi+W+Y9VUAAAAASUVORK5CYII="},8838:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"container"},[r("div",{staticClass:"user"},[r("div",{staticClass:"sidebar"},[r("Sidebar")],1),r("div",{staticClass:"main"},[r("div",{staticClass:"header"},[r("img",{attrs:{src:a("4ad7"),alt:""},on:{click:t.redirect}}),t._m(0)]),r("CommunityNotifications",{attrs:{initialShowReplyModal:t.showReplyModal}})],1),r("div",{staticClass:"popular"},[r("Popular")],1)])])},n=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"header-info"},[a("p",[t._v("通知")])])}],s=a("5530"),i=a("1da1"),o=(a("96cf"),a("9a31")),c=a("c4cd"),u=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"follow-wrapper",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.makeUnreadNotificationZero.apply(null,arguments)}}},t._l(t.getCommunityNotification,(function(e,r){return a("div",{key:r,staticClass:"follow-card"},[a("img",{attrs:{src:t._f("emptyImage")(e.senderAvatar),alt:"user avatar"}}),a("div",{staticClass:"follow-card_info"},[a("p",{staticClass:"noti-line"},[t._v(t._s(t.displayNotificationStrings(e)))]),a("p",{staticClass:"noti-text"},[t._v(t._s(e.senderText))]),a("p",{staticClass:"noti-text"},[t._v(t._s(t._f("fromNow")(e.createdAt)))])])])})),0)},l=[],d=(a("caad"),a("d81d"),a("5fad")),f=a("2fa3"),p=a("56d7"),m=a("2f62"),v=a("ac0d"),h=a("6ad5"),g={name:"CommunityNotifications",mixins:[v["a"],v["e"],v["d"]],data:function(){return{currentUser:{}}},created:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.fetchCurrentUser();case 2:return e.next=4,p["default"].emit("getAllCommunityNotification",t.currentUser);case 4:case"end":return e.stop()}}),e)})))()},sockets:{getAllCommunityNotification:function(t){this.$store.dispatch("RESET_COMMUNITY_NOTIFICATION",t)},addOneCommunityNotification:function(t){this.$store.dispatch("INCREMENT_UNREAD_COMMUNITY_NOTIFICATION"),this.$store.dispatch("SET_NEW_NOTIFICATION",t)}},methods:{makeUnreadNotificationZero:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.$store.dispatch("CLEAR_COMMUNITY_NOTIFICATION_UNREAD",{currentUserId:t.currentUser.id,types:["1"]}),e.next=3,p["default"].emit("zeroCommunityNotificationUnread",t.currentUser.id);case 3:case"end":return e.stop()}}),e)})))()},fetchCurrentUser:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,d["a"].getCurrentUser();case 2:a=e.sent,r=a.data,t.currentUser=Object(s["a"])({},r);case 5:case"end":return e.stop()}}),e)})))()},displayNotificationStrings:function(t){var e,a=["1","2","3","4"],r=a.includes(t.type)&&f["a"].formatUserTitle(t.receiverUserId,this.currentUser.id,t.receiverName),n=f["a"].getNotificationActionAndTarget(t.type);return e=t.senderName+n.action+(r||"")+(n.target||""),e}},computed:Object(s["a"])(Object(s["a"])({},Object(m["c"])({getCommunityNotification:h["o"]})),{},{notificationArr:function(){return this.getCommunityNotification.map(this.displayNotificationStrings)}})},_=g,C=(a("8a9a"),a("2877")),U=Object(C["a"])(_,u,l,!1,null,"6eb48f9a",null),A=U.exports,b=a("5e4c"),w={components:{Popular:o["a"],Sidebar:c["a"],CommunityNotifications:A},data:function(){return{showEditModal:!1,showReplyModal:!1,userId:"",userObj:{}}},created:function(){this.userId=this.$route.params.id,this.fetchUser(this.userId)},methods:{redirect:function(){this.$router.push("/usermain")},fetchUser:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,e.isLoading=!0,a.next=4,b["a"].getUser(t);case 4:if(r=a.sent,n=r.data,i=r.statusText,"OK"===i){a.next=8;break}throw new Error(i);case 8:e.userObj=Object(s["a"])({},n),e.isLoading=!1,a.next=16;break;case 12:a.prev=12,a.t0=a["catch"](0),e.isLoading=!1,console.log(a.t0);case 16:case"end":return a.stop()}}),a,null,[[0,12]])})))()},editModalToggle:function(){this.showEditModal?this.showEditModal=!1:this.showEditModal=!0}},computed:Object(s["a"])({},Object(m["c"])({getCurrentUser:h["q"]})),beforeRouteUpdate:function(t,e,a){this.$store.dispatch("SET_CURRENT_USER_FOLLOWINGS"),a()}},O=w,I=(a("08d2"),Object(C["a"])(O,r,n,!1,null,"2a5b1e54",null));e["default"]=I.exports},"8a9a":function(t,e,a){"use strict";a("d8bf")},"95ef":function(t,e,a){"use strict";a("b74c")},"99af":function(t,e,a){"use strict";var r=a("23e7"),n=a("da84"),s=a("d039"),i=a("e8b5"),o=a("861d"),c=a("7b0b"),u=a("07fa"),l=a("8418"),d=a("65f0"),f=a("1dde"),p=a("b622"),m=a("2d00"),v=p("isConcatSpreadable"),h=9007199254740991,g="Maximum allowed index exceeded",_=n.TypeError,C=m>=51||!s((function(){var t=[];return t[v]=!1,t.concat()[0]!==t})),U=f("concat"),A=function(t){if(!o(t))return!1;var e=t[v];return void 0!==e?!!e:i(t)},b=!C||!U;r({target:"Array",proto:!0,forced:b},{concat:function(t){var e,a,r,n,s,i=c(this),o=d(i,0),f=0;for(e=-1,r=arguments.length;e<r;e++)if(s=-1===e?i:arguments[e],A(s)){if(n=u(s),f+n>h)throw _(g);for(a=0;a<n;a++,f++)a in s&&l(o,f,s[a])}else{if(f>=h)throw _(g);l(o,f++,s)}return o.length=f,o}})},"9a31":function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"popular-wrapper"},[a("div",{staticClass:"popular-header"},[t._v("Popular")]),t._l(t.getTopUsers,(function(e){return a("div",{key:e.UserId,staticClass:"popular-card"},[a("img",{staticClass:"hoverStyle",attrs:{src:t._f("emptyImage")(e.avatar),alt:"user avatar"},on:{click:function(a){return a.stopPropagation(),a.preventDefault(),t.redirectToUser(e.UserId)}}}),a("div",{staticClass:"popular-card_info"},[a("p",{staticClass:"user-name"},[t._v(t._s(e.name))]),a("p",{staticClass:"user-info"},[t._v("@"+t._s(e.account))])]),e.isFollowed?a("div",{staticClass:"follow-btn"},[a("button",{staticClass:"following-btn",class:{disabled:t.currentUserId===e.UserId},attrs:{disabled:t.currentUserId===e.UserId},on:{click:function(a){return a.stopPropagation(),a.preventDefault(),t.cancel(e.UserId,e)}}},[t._v(" 正在跟隨 ")])]):a("div",{staticClass:"follow-btn"},[a("button",{staticClass:"follower-btn",class:{disabled:t.currentUserId===e.UserId},attrs:{disabled:t.currentUserId===e.UserId},on:{click:function(a){return a.stopPropagation(),a.preventDefault(),t.post(e.UserId,e)}}},[t._v(" 跟隨 ")])])])}))],2)},n=[],s=a("1da1"),i=a("5530"),o=(a("96cf"),a("2f62")),c=a("ac0d"),u=a("5fad"),l=a("6ad5"),d={name:"Popular",mixins:[c["a"],c["e"]],data:function(){return{currentUserId:"",currentUser:{}}},created:function(){this.setTopUsers(),this.getCurrentUser()},methods:Object(i["a"])(Object(i["a"])({cancel:function(t,e){var a=this.$route.params.id;this.cancelFollow({followingId:t,userId:a}),this.$emit("updateCancelView",t),this.socketSendCommunityOneNotification("4",this.currentUser,e)},post:function(t,e){var a=this.$route.params.id;this.postFollowship({followingId:t,userId:a}),this.$emit("updateFollowView",t),this.socketSendCommunityOneNotification("3",this.currentUser,e)}},Object(o["b"])({setTopUsers:l["ib"],postFollowship:l["J"],cancelFollow:l["h"]})),{},{getCurrentUser:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u["a"].getCurrentUser();case 3:if(a=e.sent,r=a.data,n=a.statusText,"OK"===n){e.next=7;break}throw new Error(n);case 7:t.currentUser=Object(i["a"])({},r),t.currentUserId=r.id,e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](0),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))()},redirectToUser:function(t){this.$router.push({name:"user",params:{id:t}})}}),computed:Object(i["a"])({},Object(o["c"])({getTopUsers:l["C"]}))},f=d,p=(a("95ef"),a("2877")),m=Object(p["a"])(f,r,n,!1,null,"4b1169b2",null);e["a"]=m.exports},"9dd4":function(t,e,a){t.exports=a.p+"img/Logo_small.21c0a93a.svg"},a357:function(t,e,a){t.exports=a.p+"img/icon_chat.6e17a436.svg"},b74c:function(t,e,a){},bf0d:function(t,e,a){t.exports=a.p+"img/icon_cog.2ff65de4.svg"},c00e:function(t,e,a){t.exports=a.p+"img/btn_noti.d84f3623.svg"},c4cd:function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"sidebar-wrapper"},[r("ul",{staticClass:"nav-links"},[r("li",[r("router-link",{attrs:{to:"#"}},[r("img",{staticClass:"logo",attrs:{src:a("9dd4"),alt:""}})])],1),r("li",[r("router-link",{attrs:{to:{name:"UserMain"}}},[r("div",{staticClass:"nav-link"},[r("img",{staticClass:"filter-orange",attrs:{src:a("dffc"),alt:""}}),r("p",{staticClass:"nav-link_text"},[t._v("首頁")])])])],1),r("li",[r("router-link",{attrs:{to:{name:"user",params:{id:t.currentUserId}}}},[r("div",{staticClass:"nav-link"},[r("img",{staticClass:"filter-orange",attrs:{src:a("8f36"),alt:""}}),r("p",{staticClass:"nav-link_text"},[t._v("個人資料")])])])],1),r("li",[r("router-link",{attrs:{to:{name:"community"}}},[r("div",{staticClass:"nav-link community"},[r("span",{staticClass:"community__icon"},[r("img",{attrs:{src:a("c00e"),alt:""}}),t.notificationUnread.communityNotification?r("span",{staticClass:"community__notification"},[t._v(t._s(t.notificationUnread.communityNotification))]):t._e()]),r("p",{staticClass:"nav-link_text"},[t._v("通知")])])])],1),r("li",[r("router-link",{attrs:{to:{name:"public-room"}}},[r("div",{staticClass:"nav-link community"},[r("span",{staticClass:"community__icon"},[r("img",{staticClass:"filter-orange",attrs:{src:a("a357"),alt:""}}),t.notificationUnread.publicMessage?r("span",{staticClass:"community__notification"},[t._v(t._s(t.notificationUnread.publicMessage))]):t._e()]),r("p",{staticClass:"nav-link_text"},[t._v("公開聊天室")])])])],1),r("li",[r("router-link",{attrs:{to:{name:"private-room"}}},[r("div",{staticClass:"nav-link community"},[r("span",{staticClass:"community__icon"},[r("img",{staticClass:"filter-orange",attrs:{src:a("a357"),alt:""}}),t.sumUpOfUnreadPrivateMessages>0?r("span",{staticClass:"community__notification"},[t._v(t._s(t.sumUpOfUnreadPrivateMessages))]):t._e()]),r("p",{staticClass:"nav-link_text"},[t._v("私人訊息")])])])],1),r("li",[r("router-link",{attrs:{to:{name:"user-setting"}}},[r("div",{staticClass:"nav-link"},[r("img",{staticClass:"filter-orange",attrs:{src:a("bf0d"),alt:""}}),r("p",{staticClass:"nav-link_text"},[t._v("設定")])])])],1),r("li",{staticClass:"nav-link"},[r("button",{on:{click:t.handleShowModalClick}},[t._v("推文")])])]),r("div",{staticClass:"logout",on:{click:t.logout}},[r("router-link",{attrs:{to:"#"}},[r("div",{staticClass:"nav-link"},[r("img",{staticClass:"filter-orange",attrs:{src:a("f667"),alt:""}}),r("p",{staticClass:"nav-link_text"},[t._v("登出")])])])],1)])},n=[],s=a("5530"),i=a("1da1"),o=(a("96cf"),a("d3b7"),a("d81d"),a("25f0"),a("56d7")),c=a("2f62"),u=a("6ad5"),l=a("5fad"),d=a("ac0d"),f=a("09e4"),p={name:"Sidebar",mixins:[d["f"]],props:{initialShowModal:{type:Boolean,required:!0}},sockets:{displayUnreadNotification:function(t){this.$store.dispatch("SET_COMMUNITY_NOTIFICATION_UNREAD",t)},unreadNotificationPublicMessageAddOne:function(){this.$store.dispatch("INCREMENT_COMMUNITY_NOTIFICATION_UNREAD_PUBLIC_MESSAGE")},displayAllUnreadPrivateMessages:function(t){var e=t.map((function(t){return t.unread})).reduce((function(t,e){return t+e}),0);this.$store.dispatch("SET_SUM_OF_UNREAD_PRIVATE_MESSAGES",e)},allUnreadPrivateMessagesSumAddOne:function(){this.$store.dispatch("SET_SUM_OF_UNREAD_PRIVATE_MESSAGES",this.sumUpOfUnreadPrivateMessages+1)}},data:function(){return{showModal:"",currentUserId:"",sum:0}},created:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.getCurrentUser();case 3:return e.next=5,o["default"].emit("getUnreadNotification",t.currentUserId.toString());case 5:return e.next=7,o["default"].emit("getAllUnreadPrivateMessages",t.currentUserId);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](0),f["a"].generalErrorHandler("無法取得資料，請稍後再試")(t);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))()},computed:Object(s["a"])({},Object(c["c"])({communityNotification:u["o"],notificationUnread:"GET_COMMUNITY_NOTIFICATION_UNREAD",sumUpOfUnreadPrivateMessages:"GET_SUM_OF_UNREAD_PRIVATE_MESSAGES"})),methods:Object(s["a"])(Object(s["a"])({},Object(c["b"])({revokeAuthentication:u["S"]})),{},{logout:function(){this.revokeAuthentication(),this.$router.push("/login")},handleShowModalClick:function(){this.showModal=!0,this.$emit("show-modal")},getCurrentUser:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var a,r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l["a"].getCurrentUser();case 3:if(a=e.sent,r=a.data,n=a.statusText,"OK"===n){e.next=7;break}throw new Error(n);case 7:t.currentUserId=r.id,e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](0),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))()}})},m=p,v=(a("fbe6"),a("2877")),h=Object(v["a"])(m,r,n,!1,null,"106eb749",null);e["a"]=h.exports},c9f6:function(t,e,a){},d8bf:function(t,e,a){},fbe6:function(t,e,a){"use strict";a("133c")}}]);
//# sourceMappingURL=chunk-b9cef676.72324df2.js.map